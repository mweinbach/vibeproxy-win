<?xml version="1.0" encoding="UTF-8" ?>
<Page
    x:Class="VibeProxy.WinUI.Views.MainPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:helpers="using:VibeProxy.WinUI.Helpers"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:viewModels="using:VibeProxy.WinUI.ViewModels"
    mc:Ignorable="d"
    x:Name="Root">

    <Page.Resources>
        <helpers:BoolToVisibilityConverter x:Key="BoolToVisibility" />
        <helpers:InverseBoolToVisibilityConverter x:Key="InverseBoolToVisibility" />
        <helpers:ExpiredToBrushConverter x:Key="ExpiredBrush" />
        <helpers:StringToVisibilityConverter x:Key="StringToVisibility" />
        <helpers:BoolToStatusBrushConverter x:Key="StatusBrush" />
    </Page.Resources>

    <ScrollViewer>
        <StackPanel Padding="24" Spacing="20">
            <TextBlock Text="VibeProxy" FontSize="24" FontWeight="SemiBold" />

            <Border Background="#10101010" CornerRadius="8" Padding="12">
                <StackPanel Orientation="Horizontal" HorizontalAlignment="Stretch" Spacing="12">
                    <TextBlock Text="Server status" VerticalAlignment="Center" />
                    <Ellipse Width="8" Height="8" Fill="{x:Bind ViewModel.IsServerRunning, Converter={StaticResource StatusBrush}}" />
                    <TextBlock Text="{x:Bind ViewModel.ServerStatusText}" VerticalAlignment="Center" />
                    <Button Content="Toggle" Click="OnToggleServerClicked" />
                </StackPanel>
            </Border>

            <StackPanel Spacing="8">
                <ToggleSwitch x:Name="LaunchToggle" Header="Launch at login" Toggled="OnLaunchAtLoginToggled" />
                <StackPanel Orientation="Horizontal" Spacing="8">
                    <TextBlock Text="Auth files" VerticalAlignment="Center" />
                    <Button Content="Open Folder" Click="OnOpenAuthFolderClicked" />
                </StackPanel>
            </StackPanel>

            <TextBlock Text="Services" FontSize="18" FontWeight="SemiBold" />

            <ItemsControl ItemsSource="{x:Bind ViewModel.Services}">
                <ItemsControl.ItemTemplate>
                    <DataTemplate x:DataType="viewModels:ServiceViewModel">
                        <Expander IsExpanded="{x:Bind IsExpanded, Mode=TwoWay}">
                            <Expander.Header>
                                <Grid ColumnDefinitions="Auto,Auto,*,Auto,Auto" ColumnSpacing="8" VerticalAlignment="Center">
                                    <ToggleSwitch IsOn="{x:Bind IsEnabled, Mode=TwoWay}" VerticalAlignment="Center" />
                                    <Image Width="20" Height="20" Source="{x:Bind IconSource}" />
                                    <TextBlock Grid.Column="2" Text="{x:Bind DisplayName}" VerticalAlignment="Center" />
                                    <ProgressRing Grid.Column="3" Width="16" Height="16" IsActive="{x:Bind IsAuthenticating}" Visibility="{x:Bind IsAuthenticating, Converter={StaticResource BoolToVisibility}}" />
                                    <Button Grid.Column="4" Content="Add Account" Click="OnConnectClicked" IsEnabled="{x:Bind IsEnabled}" />
                                </Grid>
                            </Expander.Header>
                            <StackPanel Spacing="8" Padding="8,4,8,8">
                                <TextBlock Text="Provider disabled" FontSize="12" Foreground="Gray"
                                           Visibility="{x:Bind IsEnabled, Converter={StaticResource InverseBoolToVisibility}}" />
                                <StackPanel Spacing="8" Visibility="{x:Bind IsEnabled, Converter={StaticResource BoolToVisibility}}">
                                <TextBlock Text="{x:Bind SummaryText}" FontSize="12" Foreground="Gray" />
                                <ItemsControl ItemsSource="{x:Bind Accounts}">
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate x:DataType="viewModels:AuthAccountViewModel">
                                            <StackPanel Orientation="Horizontal" Spacing="8">
                                                <Ellipse Width="6" Height="6" Fill="{x:Bind IsExpired, Converter={StaticResource ExpiredBrush}}" VerticalAlignment="Center" />
                                                <TextBlock Text="{x:Bind DisplayName}" FontSize="12" VerticalAlignment="Center" />
                                                <TextBlock Text="(expired)" FontSize="12" Foreground="Orange" Visibility="{x:Bind IsExpired, Converter={StaticResource BoolToVisibility}}" />
                                                <Button Content="Remove" Command="{x:Bind RemoveCommand}" CommandParameter="{x:Bind}" />
                                            </StackPanel>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>

                                <StackPanel Visibility="{x:Bind ShowVercelControls, Converter={StaticResource BoolToVisibility}}" Spacing="6">
                                    <ToggleSwitch Header="Use Vercel AI Gateway" IsOn="{Binding ElementName=Root, Path=ViewModel.SettingsStore.VercelGatewayEnabled, Mode=TwoWay}" />
                                    <StackPanel Orientation="Horizontal" Spacing="8">
                                        <TextBlock Text="Vercel API key" VerticalAlignment="Center" FontSize="12" />
                                        <TextBox Width="220" Text="{Binding ElementName=Root, Path=ViewModel.SettingsStore.VercelApiKey, Mode=TwoWay}" />
                                    </StackPanel>
                                </StackPanel>

                                <TextBlock Text="{x:Bind HelpText}" FontSize="12" Foreground="Gray"
                                           Visibility="{x:Bind HelpText, Converter={StaticResource StringToVisibility}}" />
                                </StackPanel>
                            </StackPanel>
                        </Expander>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>

            <StackPanel Spacing="4" HorizontalAlignment="Center">
                <StackPanel Orientation="Horizontal" Spacing="6" HorizontalAlignment="Center">
                    <TextBlock Text="VibeProxy" FontSize="12" Foreground="Gray" />
                    <TextBlock Text="|" FontSize="12" Foreground="Gray" />
                    <HyperlinkButton Content="CLIProxyAPIPlus" NavigateUri="https://github.com/router-for-me/CLIProxyAPIPlus" />
                    <TextBlock Text="|" FontSize="12" Foreground="Gray" />
                    <TextBlock Text="License: MIT" FontSize="12" Foreground="Gray" />
                </StackPanel>
                <StackPanel Orientation="Horizontal" Spacing="6" HorizontalAlignment="Center">
                    <TextBlock Text="Â© 2026 Automaze, Ltd." FontSize="12" Foreground="Gray" />
                </StackPanel>
                <HyperlinkButton Content="Report an issue" NavigateUri="https://github.com/mweinbach/vibeproxy-win/issues" />
            </StackPanel>
        </StackPanel>
    </ScrollViewer>
</Page>
